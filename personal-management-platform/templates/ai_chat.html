{% extends 'base.html' %}
{% block content %}
<h1 class="text-2xl font-semibold mb-4">AI Chat Assistant</h1>
<p class="text-sm text-muted-foreground mb-4">Ask questions or get help from the AI assistant.</p>

<form method="post" class="mb-6 border border-border rounded p-4 bg-card text-card-foreground">
    {% csrf_token %}
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
        <div>
            <label for="model" class="block text-sm text-muted-foreground mb-1">Model</label>
            <select name="model" id="model" class="w-full p-2 border border-input rounded">
                {% for value, label in models %}
                    <option value="{{ value }}" {% if value == model_selected %}selected{% endif %}>{{ label }}</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <label for="agent" class="block text-sm text-muted-foreground mb-1">Agent</label>
            <select name="agent" id="agent" class="w-full p-2 border border-input rounded">
                {% for value, label in agents %}
                    <option value="{{ value }}" {% if value == agent_selected %}selected{% endif %}>{{ label }}</option>
                {% endfor %}
            </select>
        </div>
    </div>
    <label class="block text-sm text-muted-foreground mb-1">System Prompt</label>
    <textarea name="system_prompt" rows="3" class="w-full p-2 border border-input rounded mb-3">{{ system_prompt }}</textarea>

    <label class="block text-sm text-muted-foreground mb-1">Message</label>
    <textarea name="message" rows="3" class="w-full p-2 border border-input rounded"></textarea>

    <div class="mt-3 space-x-2">
        <button type="submit" class="px-4 py-2 bg-primary text-primary-foreground rounded">Send</button>
        <button type="submit" name="action" value="clear" class="px-4 py-2 bg-secondary text-secondary-foreground rounded">Clear</button>
    </div>
</form>

<div class="border border-border rounded">
  <div class="bg-secondary text-secondary-foreground px-4 py-2">Conversation</div>
  <div class="p-4 space-y-4 max-h-[50vh] overflow-y-auto">
    {% for msg in chat %}
      <div>
        <div class="text-xs text-muted-foreground mb-1">{{ msg.role|title }}</div>
        <div class="whitespace-pre-wrap">{{ msg.content }}</div>
      </div>
    {% empty %}
      <p class="text-sm text-muted-foreground">No messages yet. Start the conversation!</p>
    {% endfor %}
  </div>
</div>
{% endblock %}
