{% extends 'admin/base.html' %}
{% load i18n unfold %}

{% block content %}
<div class="flex flex-col gap-4">
    <div class="flex flex-row items-center">
        <h2 class="text-xl font-semibold flex-1">
            {% trans "Loads" %}
        </h2>

        {% url 'load_add' as load_add_url %}
        <div class="flex flex-row gap-2">
            {% component "unfold/components/button.html" with href=load_add_url variant="primary" %}
                {% trans "Add Load" %}
            {% endcomponent %}
        </div>
    </div>

    {% component "unfold/components/card.html" %}
        <div class="p-4">
            <form method="get" class="flex flex-col gap-3 md:flex-row md:items-end md:gap-4 mb-4">
                <div class="flex items-center gap-2">
                    <label for="q" class="text-sm">{% trans "Search" %}</label>
                    <input id="q" name="q" value="{{ q }}" class="input input-bordered input-sm" placeholder="{% trans 'load name or description' %}" />
                </div>
                <div class="flex items-center gap-2">
                    <label for="route" class="text-sm">{% trans "Route" %}</label>
                    <select id="route" name="route" class="select select-bordered select-sm">
                        <option value="">{% trans "All" %}</option>
                        {% for r in routes %}
                            <option value="{{ r.id }}" {% if r.id|stringformat:'s' == route_selected %}selected{% endif %}>{{ r.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="flex items-center gap-2">
                    <label for="pstart" class="text-sm">{% trans "Pickup From" %}</label>
                    <input id="pstart" name="pstart" type="date" value="{{ pstart }}" class="input input-bordered input-sm" />
                </div>
                <div class="flex items-center gap-2">
                    <label for="pend" class="text-sm">{% trans "Pickup To" %}</label>
                    <input id="pend" name="pend" type="date" value="{{ pend }}" class="input input-bordered input-sm" />
                </div>
                <div class="md:ml-auto">
                    {% component "unfold/components/button.html" with submit=1 size="sm" %}{% trans "Apply" %}{% endcomponent %}
                    {% if q or pstart or pend or route_selected %}
                    <a href="{% url 'load_list' %}" class="text-sm ml-2 underline">{% trans "Reset" %}</a>
                    {% endif %}
                </div>
            </form>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                {% component "unfold/components/kpi.html" with title=_("Loads") metric=loads_count %}{% endcomponent %}
                {% component "unfold/components/kpi.html" with title=_("Avg Days") metric=avg_days|floatformat:1 %}{% endcomponent %}
                {% component "unfold/components/kpi.html" with title=_("Without Route") metric=without_route %}{% endcomponent %}
            </div>

            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-2">
                <div class="text-sm">
                    <a href="?q={{ q }}&route={{ route_selected }}&pstart={{ pstart }}&pend={{ pend }}&export=csv" class="underline">{% trans "Export CSV" %}</a>
                    <span class="mx-2">Â·</span>
                    <a href="{{ download_template_url }}" class="underline">{% trans "Download CSV Template" %}</a>
                </div>
                <form method="post" enctype="multipart/form-data" class="flex items-center gap-2">{% csrf_token %}
                    <input type="file" name="csv_file" accept=".csv" class="file-input file-input-sm" />
                    {% component "unfold/components/button.html" with submit=1 size="sm" %}{% trans "Import CSV" %}{% endcomponent %}
                </form>
            </div>

            {% component "unfold/components/table.html" with table=load_table card_included=1 %}{% endcomponent %}
        </div>
    {% endcomponent %}
</div>
{% endblock %}
